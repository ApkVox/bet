<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Predictor AI</title>
    <meta name="description" content="Predicciones NBA con Machine Learning e Inteligencia Artificial">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* ==========================================
           CSS VARIABLES - THEME SYSTEM
           ========================================== */
        :root {
            /* Light Theme (Default) */
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-card-hover: #fafafa;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-tertiary: #6e6e73;
            --accent: #0071e3;
            --accent-hover: #0077ed;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ff9500;
            --border: rgba(0, 0, 0, 0.08);
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 28px;
        }

        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-card: #1c1c1e;
            --bg-card-hover: #2c2c2e;
            --text-primary: #f5f5f7;
            --text-secondary: #98989d;
            --text-tertiary: #8e8e93;
            --accent: #0a84ff;
            --accent-hover: #409cff;
            --success: #30d158;
            --danger: #ff453a;
            --warning: #ff9f0a;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        /* ==========================================
           BASE STYLES
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* ==========================================
           HEADER
           ========================================== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 28px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-hover);
        }

        /* ==========================================
           NAVIGATION
           ========================================== */
        .nav-tabs {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            padding: 4px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-tab.active {
            background: var(--accent);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        /* ==========================================
           MAIN CONTAINER
           ========================================== */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ==========================================
           BENTO GRID - STATS
           ========================================== */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .bento-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .bento-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .bento-card.accent {
            background: linear-gradient(135deg, var(--accent), #5856d6);
            color: white;
            border: none;
        }

        .bento-card.accent .stat-label {
            color: rgba(255, 255, 255, 0.8);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 12px;
        }

        /* ==========================================
           PREDICTIONS GRID
           ========================================== */
        .predictions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 20px;
        }

        /* ==========================================
           PREDICTION CARD
           ========================================== */
        .prediction-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .prediction-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .match-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
        }

        .team-logo {
            width: 56px;
            height: 56px;
            margin-bottom: 8px;
            object-fit: contain;
        }

        .team-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .vs-badge {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
        }

        .prediction-result {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }

        .predicted-winner {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .probability {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .probability-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .prediction-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .meta-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .meta-tag.positive {
            background: rgba(52, 199, 89, 0.15);
            color: var(--success);
        }

        .meta-tag.negative {
            background: rgba(255, 59, 48, 0.15);
            color: var(--danger);
        }

        /* ==========================================
           HISTORY TABLE
           ========================================== */
        .history-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .history-table-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th {
            text-align: left;
            padding: 16px 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .history-table td {
            padding: 16px 20px;
            font-size: 14px;
            border-bottom: 1px solid var(--border);
        }

        .history-table tr:last-child td {
            border-bottom: none;
        }

        .history-table tr:hover {
            background: var(--bg-card-hover);
        }

        .result-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .result-badge.win {
            background: rgba(52, 199, 89, 0.15);
            color: var(--success);
        }

        .result-badge.loss {
            background: rgba(255, 59, 48, 0.15);
            color: var(--danger);
        }

        .result-badge.pending {
            background: rgba(255, 149, 0, 0.15);
            color: var(--warning);
        }

        /* ==========================================
           LOADING & EMPTY STATES
           ========================================== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* ==========================================
           MOBILE RESPONSIVE
           ========================================== */
        @media (max-width: 768px) {
            .header-content {
                padding: 12px 16px;
            }

            .logo-text {
                display: none;
            }

            .nav-tabs {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 100;
                border-radius: 0;
                padding: 8px 16px;
                justify-content: center;
                background: var(--bg-secondary);
                border-top: 1px solid var(--border);
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            }

            .nav-tab {
                flex: 1;
                text-align: center;
                padding: 12px 8px;
            }

            .main {
                padding: 16px;
                padding-bottom: 100px;
            }

            .bento-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .bento-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 24px;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .prediction-card {
                padding: 20px;
            }

            .team-logo {
                width: 48px;
                height: 48px;
            }

            .history-table th,
            .history-table td {
                padding: 12px;
                font-size: 13px;
            }

            .section-title {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .bento-grid {
                grid-template-columns: 1fr 1fr;
            }

            .stat-value {
                font-size: 20px;
            }

            .stat-label {
                font-size: 12px;
            }

            .probability {
                font-size: 24px;
            }
        }

        /* ==========================================
           MODAL
           ========================================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 24px;
        }

        .analysis-text {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-secondary);
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üèÄ</span>
                <span class="logo-text">NBA Predictor AI</span>
            </div>
            <div class="header-actions">
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-section="predictions">Predicciones</button>
                    <button class="nav-tab" data-section="history">Historial</button>
                </nav>
                <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                    üåô
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main">
        <!-- PREDICTIONS SECTION -->
        <section id="predictions" class="section active">
            <!-- Bento Stats Grid -->
            <div class="bento-grid">
                <div class="bento-card accent">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-value" id="accuracy-stat">--</div>
                    <div class="stat-label">Precisi√≥n</div>
                </div>
                <div class="bento-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="total-predictions">--</div>
                    <div class="stat-label">Predicciones</div>
                </div>
                <div class="bento-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="wins-stat">--</div>
                    <div class="stat-label">Aciertos</div>
                </div>
                <div class="bento-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="games-today">--</div>
                    <div class="stat-label">Partidos Hoy</div>
                </div>
            </div>

            <!-- Predictions Header -->
            <div class="predictions-header">
                <h2 class="section-title">Partidos de Hoy</h2>
            </div>

            <!-- Predictions Grid -->
            <div class="predictions-grid" id="predictionsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Cargando predicciones...</span>
                </div>
            </div>
        </section>

        <!-- HISTORY SECTION -->
        <section id="history" class="section">
            <div class="predictions-header">
                <h2 class="section-title">Historial de Predicciones</h2>
            </div>

            <div class="history-filters">
                <button class="filter-btn active" data-filter="all">Todas</button>
                <button class="filter-btn" data-filter="win">Ganadas</button>
                <button class="filter-btn" data-filter="loss">Perdidas</button>
                <button class="filter-btn" data-filter="pending">Pendientes</button>
            </div>

            <div class="history-table-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Partido</th>
                            <th>Predicci√≥n</th>
                            <th>Prob.</th>
                            <th>Resultado</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="5" class="loading">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">An√°lisis del Partido</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <p class="analysis-text">Cargando an√°lisis...</p>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // NBA TEAM LOGOS
        // ==========================================
        const NBA_LOGOS = {
            "Atlanta Hawks": "https://cdn.nba.com/logos/nba/1610612737/global/L/logo.svg",
            "Boston Celtics": "https://cdn.nba.com/logos/nba/1610612738/global/L/logo.svg",
            "Brooklyn Nets": "https://cdn.nba.com/logos/nba/1610612751/global/L/logo.svg",
            "Charlotte Hornets": "https://cdn.nba.com/logos/nba/1610612766/global/L/logo.svg",
            "Chicago Bulls": "https://cdn.nba.com/logos/nba/1610612741/global/L/logo.svg",
            "Cleveland Cavaliers": "https://cdn.nba.com/logos/nba/1610612739/global/L/logo.svg",
            "Dallas Mavericks": "https://cdn.nba.com/logos/nba/1610612742/global/L/logo.svg",
            "Denver Nuggets": "https://cdn.nba.com/logos/nba/1610612743/global/L/logo.svg",
            "Detroit Pistons": "https://cdn.nba.com/logos/nba/1610612765/global/L/logo.svg",
            "Golden State Warriors": "https://cdn.nba.com/logos/nba/1610612744/global/L/logo.svg",
            "Houston Rockets": "https://cdn.nba.com/logos/nba/1610612745/global/L/logo.svg",
            "Indiana Pacers": "https://cdn.nba.com/logos/nba/1610612754/global/L/logo.svg",
            "LA Clippers": "https://cdn.nba.com/logos/nba/1610612746/global/L/logo.svg",
            "Los Angeles Lakers": "https://cdn.nba.com/logos/nba/1610612747/global/L/logo.svg",
            "Memphis Grizzlies": "https://cdn.nba.com/logos/nba/1610612763/global/L/logo.svg",
            "Miami Heat": "https://cdn.nba.com/logos/nba/1610612748/global/L/logo.svg",
            "Milwaukee Bucks": "https://cdn.nba.com/logos/nba/1610612749/global/L/logo.svg",
            "Minnesota Timberwolves": "https://cdn.nba.com/logos/nba/1610612750/global/L/logo.svg",
            "New Orleans Pelicans": "https://cdn.nba.com/logos/nba/1610612740/global/L/logo.svg",
            "New York Knicks": "https://cdn.nba.com/logos/nba/1610612752/global/L/logo.svg",
            "Oklahoma City Thunder": "https://cdn.nba.com/logos/nba/1610612760/global/L/logo.svg",
            "Orlando Magic": "https://cdn.nba.com/logos/nba/1610612753/global/L/logo.svg",
            "Philadelphia 76ers": "https://cdn.nba.com/logos/nba/1610612755/global/L/logo.svg",
            "Phoenix Suns": "https://cdn.nba.com/logos/nba/1610612756/global/L/logo.svg",
            "Portland Trail Blazers": "https://cdn.nba.com/logos/nba/1610612757/global/L/logo.svg",
            "Sacramento Kings": "https://cdn.nba.com/logos/nba/1610612758/global/L/logo.svg",
            "San Antonio Spurs": "https://cdn.nba.com/logos/nba/1610612759/global/L/logo.svg",
            "Toronto Raptors": "https://cdn.nba.com/logos/nba/1610612761/global/L/logo.svg",
            "Utah Jazz": "https://cdn.nba.com/logos/nba/1610612762/global/L/logo.svg",
            "Washington Wizards": "https://cdn.nba.com/logos/nba/1610612764/global/L/logo.svg"
        };

        // ==========================================
        // THEME MANAGEMENT
        // ==========================================
        const themeToggle = document.getElementById('themeToggle');

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function initTheme() {
            const saved = localStorage.getItem('theme');
            if (saved) {
                setTheme(saved);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme('dark');
            }
        }

        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            setTheme(current === 'dark' ? 'light' : 'dark');
        });

        initTheme();

        // ==========================================
        // NAVIGATION
        // ==========================================
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.section).classList.add('active');
            });
        });

        // ==========================================
        // HISTORY FILTERS
        // ==========================================
        let allHistory = [];

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderHistory(btn.dataset.filter);
            });
        });

        // ==========================================
        // DATA LOADING
        // ==========================================
        let currentPredictions = [];

        async function loadPredictions() {
            try {
                const response = await fetch('/predict-today');
                const data = await response.json();
                currentPredictions = data.predictions || [];

                document.getElementById('games-today').textContent = currentPredictions.length;
                renderPredictions(currentPredictions);
            } catch (error) {
                console.error('Error loading predictions:', error);
                document.getElementById('predictionsGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <p>Error cargando predicciones</p>
                    </div>
                `;
            }
        }

        async function loadHistory() {
            try {
                const response = await fetch('/history/full?days=30');
                const data = await response.json();
                allHistory = data.history || [];

                // Calculate stats
                const wins = allHistory.filter(h => h.result === 'WIN').length;
                const losses = allHistory.filter(h => h.result === 'LOSS').length;
                const total = wins + losses;
                const accuracy = total > 0 ? Math.round((wins / total) * 100) : 0;

                document.getElementById('accuracy-stat').textContent = accuracy + '%';
                document.getElementById('total-predictions').textContent = allHistory.length;
                document.getElementById('wins-stat').textContent = wins;

                renderHistory('all');
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        // ==========================================
        // RENDER FUNCTIONS
        // ==========================================
        function renderPredictions(predictions) {
            const grid = document.getElementById('predictionsGrid');

            if (!predictions.length) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üèÄ</div>
                        <p>No hay partidos programados para hoy</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = predictions.map((pred, idx) => `
                <div class="prediction-card" onclick="showDetails(${idx})">
                    <div class="match-header">
                        <div class="team">
                            <img class="team-logo" src="${NBA_LOGOS[pred.home_team] || ''}" alt="${pred.home_team}" onerror="this.style.display='none'">
                            <span class="team-name">${pred.home_team}</span>
                        </div>
                        <span class="vs-badge">VS</span>
                        <div class="team">
                            <img class="team-logo" src="${NBA_LOGOS[pred.away_team] || ''}" alt="${pred.away_team}" onerror="this.style.display='none'">
                            <span class="team-name">${pred.away_team}</span>
                        </div>
                    </div>
                    <div class="prediction-result">
                        <div class="predicted-winner">${pred.winner}</div>
                        <div class="probability">${pred.win_probability}%</div>
                        <div class="probability-label">Probabilidad de victoria</div>
                    </div>
                    <div class="prediction-meta">
                        ${pred.ev_value > 0 ? `<span class="meta-tag positive">EV +${pred.ev_value?.toFixed(1)}%</span>` : ''}
                        ${pred.kelly_stake_pct > 0 ? `<span class="meta-tag">Kelly ${pred.kelly_stake_pct?.toFixed(1)}%</span>` : ''}
                        ${pred.warning_level === 'HIGH' ? `<span class="meta-tag negative">‚ö†Ô∏è Alto Riesgo</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderHistory(filter) {
            const tbody = document.getElementById('historyTableBody');
            let filtered = allHistory;

            if (filter !== 'all') {
                filtered = allHistory.filter(h => h.result?.toLowerCase() === filter);
            }

            if (!filtered.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <p>No hay registros</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(h => `
                <tr>
                    <td>${h.date}</td>
                    <td>${h.match_id}</td>
                    <td><strong>${h.winner}</strong></td>
                    <td>${h.win_probability}%</td>
                    <td>
                        <span class="result-badge ${h.result?.toLowerCase() || 'pending'}">
                            ${h.result === 'WIN' ? '‚úì Ganada' : h.result === 'LOSS' ? '‚úó Perdida' : '‚è≥ Pendiente'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // ==========================================
        // MODAL
        // ==========================================
        function showDetails(index) {
            const pred = currentPredictions[index];
            if (!pred) return;

            document.getElementById('modalTitle').textContent = `${pred.home_team} vs ${pred.away_team}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 16px;">
                    <strong style="color: var(--accent);">${pred.winner}</strong> gana con <strong>${pred.win_probability}%</strong> de probabilidad
                </div>
                <p class="analysis-text">${pred.ai_analysis || 'An√°lisis no disponible'}</p>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // ==========================================
        // INIT
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            loadPredictions();
            loadHistory();
        });
    </script>
</body>

</html>