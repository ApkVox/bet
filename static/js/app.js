const NBA_LOGOS = {
    "Atlanta Hawks": "https://cdn.nba.com/logos/nba/1610612737/global/L/logo.svg",
    "Boston Celtics": "https://cdn.nba.com/logos/nba/1610612738/global/L/logo.svg",
    "Brooklyn Nets": "https://cdn.nba.com/logos/nba/1610612751/global/L/logo.svg",
    "Charlotte Hornets": "https://cdn.nba.com/logos/nba/1610612766/global/L/logo.svg",
    "Chicago Bulls": "https://cdn.nba.com/logos/nba/1610612741/global/L/logo.svg",
    "Cleveland Cavaliers": "https://cdn.nba.com/logos/nba/1610612739/global/L/logo.svg",
    "Dallas Mavericks": "https://cdn.nba.com/logos/nba/1610612742/global/L/logo.svg",
    "Denver Nuggets": "https://cdn.nba.com/logos/nba/1610612743/global/L/logo.svg",
    "Detroit Pistons": "https://cdn.nba.com/logos/nba/1610612765/global/L/logo.svg",
    "Golden State Warriors": "https://cdn.nba.com/logos/nba/1610612744/global/L/logo.svg",
    "Houston Rockets": "https://cdn.nba.com/logos/nba/1610612745/global/L/logo.svg",
    "Indiana Pacers": "https://cdn.nba.com/logos/nba/1610612754/global/L/logo.svg",
    "LA Clippers": "https://cdn.nba.com/logos/nba/1610612746/global/L/logo.svg",
    "Los Angeles Lakers": "https://cdn.nba.com/logos/nba/1610612747/global/L/logo.svg",
    "Memphis Grizzlies": "https://cdn.nba.com/logos/nba/1610612763/global/L/logo.svg",
    "Miami Heat": "https://cdn.nba.com/logos/nba/1610612748/global/L/logo.svg",
    "Milwaukee Bucks": "https://cdn.nba.com/logos/nba/1610612749/global/L/logo.svg",
    "Minnesota Timberwolves": "https://cdn.nba.com/logos/nba/1610612750/global/L/logo.svg",
    "New Orleans Pelicans": "https://cdn.nba.com/logos/nba/1610612740/global/L/logo.svg",
    "New York Knicks": "https://cdn.nba.com/logos/nba/1610612752/global/L/logo.svg",
    "Oklahoma City Thunder": "https://cdn.nba.com/logos/nba/1610612760/global/L/logo.svg",
    "Orlando Magic": "https://cdn.nba.com/logos/nba/1610612753/global/L/logo.svg",
    "Philadelphia 76ers": "https://cdn.nba.com/logos/nba/1610612755/global/L/logo.svg",
    "Phoenix Suns": "https://cdn.nba.com/logos/nba/1610612756/global/L/logo.svg",
    "Portland Trail Blazers": "https://cdn.nba.com/logos/nba/1610612757/global/L/logo.svg",
    "Sacramento Kings": "https://cdn.nba.com/logos/nba/1610612758/global/L/logo.svg",
    "San Antonio Spurs": "https://cdn.nba.com/logos/nba/1610612759/global/L/logo.svg",
    "Toronto Raptors": "https://cdn.nba.com/logos/nba/1610612761/global/L/logo.svg",
    "Utah Jazz": "https://cdn.nba.com/logos/nba/1610612762/global/L/logo.svg",
    "Washington Wizards": "https://cdn.nba.com/logos/nba/1610612764/global/L/logo.svg"
};

const PL_LOGOS = {
    "Arsenal": "https://resources.premierleague.com/premierleague/badges/50/t3.png",
    "Aston Villa": "https://resources.premierleague.com/premierleague/badges/50/t7.png",
    "AFC Bournemouth": "https://resources.premierleague.com/premierleague/badges/50/t91.png",
    "Bournemouth": "https://resources.premierleague.com/premierleague/badges/50/t91.png",
    "Brentford": "https://resources.premierleague.com/premierleague/badges/50/t94.png",
    "Brighton & Hove Albion": "https://resources.premierleague.com/premierleague/badges/50/t36.png",
    "Brighton": "https://resources.premierleague.com/premierleague/badges/50/t36.png",
    "Burnley": "https://resources.premierleague.com/premierleague/badges/50/t90.png",
    "Chelsea": "https://resources.premierleague.com/premierleague/badges/50/t8.png",
    "Crystal Palace": "https://resources.premierleague.com/premierleague/badges/50/t31.png",
    "Everton": "https://resources.premierleague.com/premierleague/badges/50/t11.png",
    "Fulham": "https://resources.premierleague.com/premierleague/badges/50/t54.png",
    "Ipswich Town": "https://resources.premierleague.com/premierleague/badges/50/t40.png",
    "Ipswich": "https://resources.premierleague.com/premierleague/badges/50/t40.png",
    "Leeds United": "https://resources.premierleague.com/premierleague/badges/50/t2.png",
    "Leeds": "https://resources.premierleague.com/premierleague/badges/50/t2.png",
    "Leicester City": "https://resources.premierleague.com/premierleague/badges/50/t13.png",
    "Leicester": "https://resources.premierleague.com/premierleague/badges/50/t13.png",
    "Liverpool": "https://resources.premierleague.com/premierleague/badges/50/t14.png",
    "Liverpool FC": "https://resources.premierleague.com/premierleague/badges/50/t14.png",
    "Manchester City": "https://resources.premierleague.com/premierleague/badges/50/t43.png",
    "Man City": "https://resources.premierleague.com/premierleague/badges/50/t43.png",
    "Manchester United": "https://resources.premierleague.com/premierleague/badges/50/t1.png",
    "Man United": "https://resources.premierleague.com/premierleague/badges/50/t1.png",
    "Newcastle United": "https://resources.premierleague.com/premierleague/badges/50/t4.png",
    "Newcastle": "https://resources.premierleague.com/premierleague/badges/50/t4.png",
    "Nottingham Forest": "https://resources.premierleague.com/premierleague/badges/50/t17.png",
    "Nott'm Forest": "https://resources.premierleague.com/premierleague/badges/50/t17.png",
    "Southampton": "https://resources.premierleague.com/premierleague/badges/50/t20.png",
    "Sunderland": "https://resources.premierleague.com/premierleague/badges/50/t56.png",
    "Tottenham Hotspur": "https://resources.premierleague.com/premierleague/badges/50/t6.png",
    "Tottenham": "https://resources.premierleague.com/premierleague/badges/50/t6.png",
    "West Ham United": "https://resources.premierleague.com/premierleague/badges/50/t21.png",
    "West Ham": "https://resources.premierleague.com/premierleague/badges/50/t21.png",
    "Wolverhampton Wanderers": "https://resources.premierleague.com/premierleague/badges/50/t39.png",
    "Wolves": "https://resources.premierleague.com/premierleague/badges/50/t39.png"
};

// Theme
const themeToggle = document.getElementById('themeToggle');
const mobileThemeToggle = document.getElementById('mobileThemeToggle');
const mobileThemeIcon = document.getElementById('mobileThemeIcon');

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    const icon = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    if (themeToggle) themeToggle.textContent = icon;
    if (mobileThemeIcon) mobileThemeIcon.textContent = icon;
}

function initTheme() {
    const saved = localStorage.getItem('theme');
    if (saved) setTheme(saved);
    else if (window.matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark');
}

function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    setTheme(current === 'dark' ? 'light' : 'dark');
}

if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
if (mobileThemeToggle) mobileThemeToggle.addEventListener('click', toggleTheme);
initTheme();

// Navigation
function switchSection(sectionId) {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.mobile-nav-btn').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

    document.querySelector(`.nav-tab[data-section="${sectionId}"]`)?.classList.add('active');
    document.querySelector(`.mobile-nav-btn[data-section="${sectionId}"]`)?.classList.add('active');
    document.getElementById(sectionId)?.classList.add('active');
}

document.querySelectorAll('.nav-tab, .mobile-nav-btn[data-section]').forEach(btn => {
    btn.addEventListener('click', () => {
        if (btn.dataset.section) switchSection(btn.dataset.section);
    });
});

// UI: Toast & Skeletons
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    if (!container) return;

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
        <span>${message}</span>
    `;

    container.appendChild(toast);

    // Remove after 3s
    setTimeout(() => {
        toast.style.animation = 'toast-out 0.3s forwards';
        toast.addEventListener('animationend', () => {
            if (toast.parentElement) toast.remove();
        });
    }, 3000);
}

function renderSkeletonCards(count) {
    return Array(count).fill(0).map(() => `
        <div class="prediction-card">
            <div class="match-header">
                <div class="team">
                    <div class="skeleton" style="width: 48px; height: 48px; border-radius: 50%; margin-bottom: 6px;"></div>
                    <div class="skeleton skeleton-text" style="width: 60px;"></div>
                </div>
                <span class="vs-badge">VS</span>
                <div class="team">
                    <div class="skeleton" style="width: 48px; height: 48px; border-radius: 50%; margin-bottom: 6px;"></div>
                    <div class="skeleton skeleton-text" style="width: 60px;"></div>
                </div>
            </div>
            <div class="prediction-result" style="padding:12px;">
                <div class="skeleton skeleton-text" style="width: 100px; height: 16px; margin: 0 auto 8px;"></div>
                <div class="skeleton skeleton-text" style="width: 80px; height: 24px; margin: 0 auto;"></div>
            </div>
        </div>
    `).join('');
}

function renderSkeletonHistory(count) {
    return Array(count).fill(0).map(() => `
         <div class="history-card">
            <div class="history-teams">
                <div class="history-team">
                    <div class="skeleton" style="width: 40px; height: 40px; border-radius: 50%; margin-bottom: 6px;"></div>
                    <div class="skeleton skeleton-text" style="width: 50px;"></div>
                </div>
                <span class="history-vs">VS</span>
                <div class="history-team">
                    <div class="skeleton" style="width: 40px; height: 40px; border-radius: 50%; margin-bottom: 6px;"></div>
                    <div class="skeleton skeleton-text" style="width: 50px;"></div>
                </div>
            </div>
            <div class="history-info">
                <div class="skeleton skeleton-text" style="width: 120px;"></div>
                <div class="skeleton skeleton-text" style="width: 80px;"></div>
            </div>
        </div>
    `).join('');
}

// Data
let currentSport = 'nba'; // 'nba' or 'football'
let currentPredictions = [];
let allHistory = [];
let currentHistoryLimit = 20;

// Sport Selection
document.querySelectorAll('.sport-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        if (btn.classList.contains('active')) return;

        // Update UI
        document.querySelectorAll('.sport-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Update State
        currentSport = btn.dataset.sport;

        // Reload Data
        loadPredictions();
        loadHistory();
    });
});

async function loadPredictions() {
    const grid = document.getElementById('predictionsGrid');

    // Football Under Construction
    if (currentSport === 'football') {
        grid.innerHTML = `
            <div class="empty-state" style="padding: 40px 20px;">
                <div class="empty-icon" style="font-size: 64px; margin-bottom: 20px;">üöß</div>
                <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">En Construcci√≥n</h3>
                <p style="color: var(--text-secondary); max-width: 300px; margin: 0 auto;">
                    Estamos mejorando nuestro modelo de predicci√≥n para f√∫tbol. 
                    <br>¬°Pronto volveremos con mejores aciertos!
                </p>
            </div>`;
        document.getElementById('games-today').textContent = '0';
        return;
    }

    grid.innerHTML = renderSkeletonCards(6);

    try {
        const endpoint = '/predict-today'; // Only NBA for now
        const response = await fetch(endpoint);
        if (!response.ok) throw new Error('Error de red');
        const data = await response.json();

        // API structure
        currentPredictions = data.predictions || [];

        document.getElementById('games-today').textContent = currentPredictions.length;
        renderPredictions(currentPredictions);
    } catch (error) {
        console.error(error);
        grid.innerHTML = `
            <div class="empty-state"><div class="empty-icon">‚ö†Ô∏è</div><p>Error cargando datos</p></div>`;
        showToast('Error cargando predicciones', 'error');
    }
}

async function loadHistory() {
    currentHistoryLimit = 20;
    const container = document.getElementById('historyContainer');

    if (currentSport === 'football') {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üìÇ</div>
                <p>Historial de f√∫tbol no disponible durante el mantenimiento.</p>
            </div>`;
        return;
    }

    container.innerHTML = `<div class="history-cards">${renderSkeletonHistory(6)}</div>`;

    try {
        const endpoint = '/history/full?days=365'; // Only NBA for now
        const response = await fetch(endpoint);
        if (!response.ok) throw new Error('Error al cargar historial');
        const data = await response.json();

        // API diff
        allHistory = data.history || [];

        const wins = allHistory.filter(h => h.result === 'WIN').length;
        const losses = allHistory.filter(h => h.result === 'LOSS').length;
        const total = wins + losses;
        const accuracy = total > 0 ? Math.round((wins / total) * 100) : 0;

        document.getElementById('accuracy-stat').textContent = accuracy + '%';
        document.getElementById('total-predictions').textContent = allHistory.length;
        document.getElementById('wins-stat').textContent = wins;

        renderHistory('all');
    } catch (error) {
        console.error('Error loading history:', error);
        container.innerHTML = `<div class="empty-state"><div class="empty-icon">‚ö†Ô∏è</div><p>Error historial</p></div>`;
        showToast('Error cargando historial', 'error');
    }
}

function renderPredictions(predictions) {
    const grid = document.getElementById('predictionsGrid');
    if (!predictions.length) {
        const icon = currentSport === 'football' ? '‚öΩ' : 'üèÄ';
        grid.innerHTML = `<div class="empty-state"><div class="empty-icon">${icon}</div><p>No hay partidos de ${currentSport === 'football' ? 'f√∫tbol' : 'NBA'} hoy</p></div>`;
        return;
    }

    grid.innerHTML = predictions.map((pred, idx) => {
        if (currentSport === 'football') {
            // FOOTBALL CARD (3-way)
            return `
            <div class="prediction-card" onclick="showDetails(${idx})" style="position: relative; overflow: hidden;">
                <div class="league-badge" style="position: absolute; top: 12px; right: 12px; font-size: 10px; opacity: 0.6; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">${pred.league || 'Premier League'}</div>
                <div class="match-header" style="margin-top: 10px;">
                    <div class="team">
                        <img class="team-logo" src="${pred.home_logo || ''}" alt="" onerror="this.style.display='none'">
                        <span class="team-name">${pred.home_team}</span>
                    </div>
                    <span class="vs-badge">VS</span>
                    <div class="team">
                        <img class="team-logo" src="${pred.away_logo || ''}" alt="" onerror="this.style.display='none'">
                        <span class="team-name">${pred.away_team}</span>
                    </div>
                </div>
                <div class="prediction-result" style="margin-top: 16px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 12px;">
                    <div class="prob-box" style="text-align: center; padding: 8px 4px; background: ${pred.prediction === '1' || pred.prediction === pred.home_team ? 'var(--bg-card-hover)' : 'transparent'}; border-radius: var(--radius-sm); border: 1px solid ${pred.prediction === '1' || pred.prediction === pred.home_team ? 'var(--accent)' : 'transparent'};">
                        <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${pred.home_team}</div>
                        <div style="font-size: 18px; font-weight: 700; color: ${pred.prediction === '1' || pred.prediction === pred.home_team ? 'var(--accent)' : 'var(--text-primary)'}">${(pred.prob_home * 100).toFixed(0)}%</div>
                    </div>
                    <div class="prob-box" style="text-align: center; padding: 8px 4px; background: ${pred.prediction === 'X' || pred.prediction === 'Draw' ? 'var(--bg-card-hover)' : 'transparent'}; border-radius: var(--radius-sm); border: 1px solid ${pred.prediction === 'X' || pred.prediction === 'Draw' ? 'var(--accent)' : 'transparent'};">
                        <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px;">Empate</div>
                        <div style="font-size: 18px; font-weight: 700; color: ${pred.prediction === 'X' || pred.prediction === 'Draw' ? 'var(--accent)' : 'var(--text-primary)'}">${(pred.prob_draw * 100).toFixed(0)}%</div>
                    </div>
                    <div class="prob-box" style="text-align: center; padding: 8px 4px; background: ${pred.prediction === '2' || pred.prediction === pred.away_team ? 'var(--bg-card-hover)' : 'transparent'}; border-radius: var(--radius-sm); border: 1px solid ${pred.prediction === '2' || pred.prediction === pred.away_team ? 'var(--accent)' : 'transparent'};">
                        <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${pred.away_team}</div>
                        <div style="font-size: 18px; font-weight: 700; color: ${pred.prediction === '2' || pred.prediction === pred.away_team ? 'var(--accent)' : 'var(--text-primary)'}">${(pred.prob_away * 100).toFixed(0)}%</div>
                    </div>
                </div>
                <div class="probability-label" style="text-align: center; margin-top: -8px; margin-bottom: 12px;">Probabilidades</div>
                <div class="prediction-meta" style="justify-content: center;">
                    <span class="meta-tag" style="background: rgba(0, 113, 227, 0.1); color: var(--accent); font-weight: 700;">Pred: ${pred.prediction === '1' ? pred.home_team : pred.prediction === '2' ? pred.away_team : 'Empate'}</span>
                </div>
            </div>
            `;
        } else {
            // NBA CARD (Existing)
            return `
            <div class="prediction-card" onclick="showDetails(${idx})">
                <div class="match-header">
                    <div class="team">
                        <img class="team-logo" src="${NBA_LOGOS[pred.home_team] || ''}" alt="" onerror="this.style.display='none'">
                        <span class="team-name">${pred.home_team}</span>
                    </div>
                    <span class="vs-badge">VS</span>
                    <div class="team">
                        <img class="team-logo" src="${NBA_LOGOS[pred.away_team] || ''}" alt="" onerror="this.style.display='none'">
                        <span class="team-name">${pred.away_team}</span>
                    </div>
                </div>
                <div class="prediction-result">
                    <div class="predicted-winner">${pred.winner}</div>
                    <div class="probability">${pred.win_probability}%</div>
                    <div class="probability-label">Probabilidad</div>
                </div>
                <div class="prediction-meta">
                    ${pred.ev_value > 0 ? `<span class="meta-tag positive">EV +${pred.ev_value?.toFixed(1)}%</span>` : ''}
                    ${pred.warning_level === 'HIGH' ? `<span class="meta-tag negative">‚ö†Ô∏è Riesgo</span>` : ''}
                </div>
            </div>
            `;
        }
    }).join('');
}

function loadMoreHistory() {
    currentHistoryLimit += 20;
    const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
    renderHistory(activeFilter);
}

function renderHistory(filter) {
    const container = document.getElementById('historyContainer');
    let filtered = allHistory;
    if (filter !== 'all') {
        filtered = allHistory.filter(h => {
            const res = h.result ? h.result.toLowerCase() : 'pending';
            return res === filter;
        });
    }

    if (!filtered.length) {
        container.innerHTML = `<div class="empty-state"><div class="empty-icon">üì≠</div><p>No hay registros</p></div>`;
        return;
    }

    const visible = filtered.slice(0, currentHistoryLimit);

    // Group by date
    const grouped = {};
    visible.forEach(h => {
        if (!grouped[h.date]) grouped[h.date] = [];
        grouped[h.date].push(h);
    });

    // Sort dates descending
    const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

    let html = sortedDates.map(date => {
        const games = grouped[date];
        const dateObj = new Date(date + 'T12:00:00');
        const formatted = dateObj.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });

        return `
            <div class="history-day">
                <div class="history-day-header">${formatted}</div>
                <div class="history-cards">
                    ${games.map(h => {
            const teams = h.match?.split(' vs ') || ['', ''];
            const home = teams[0]?.trim() || '';
            const away = teams[1]?.trim() || '';
            return `
                            <div class="history-card">
                                <div class="history-teams">
                                    <div class="history-team">
                                        <img class="history-team-logo" src="${h.home_logo || (currentSport === 'nba' ? (NBA_LOGOS[home] || '') : (PL_LOGOS[home] || ''))}" alt="" onerror="this.style.display='none'">
                                        <span class="history-team-name">${home}</span>
                                    </div>
                                    <span class="history-vs">VS</span>
                                    <div class="history-team">
                                        <img class="history-team-logo" src="${h.away_logo || (currentSport === 'nba' ? (NBA_LOGOS[away] || '') : (PL_LOGOS[away] || ''))}" alt="" onerror="this.style.display='none'">
                                        <span class="history-team-name">${away}</span>
                                    </div>
                                </div>
                                <div class="history-info">
                                    <div class="history-prediction">Predicci√≥n: <strong>${h.predicted_winner}</strong> (${h.probability}%)</div>
                                    <span class="result-badge ${h.result?.toLowerCase() || 'pending'}">
                                        ${h.result === 'WIN' ? '‚úì Ganada' : h.result === 'LOSS' ? '‚úó Perdida' : '‚è≥ Pendiente'}
                                    </span>
                                </div>
                            </div>
                        `;
        }).join('')}
                </div>
            </div>
        `;
    }).join('');

    if (filtered.length > currentHistoryLimit) {
        html += `
            <div class="load-more-container">
                <button class="load-more-btn" onclick="loadMoreHistory()">Ver m√°s partidos...</button>
            </div>
        `;
    }

    container.innerHTML = html;
}

// Filters
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderHistory(btn.dataset.filter);
    });
});

// Modal
function showDetails(index) {
    const pred = currentPredictions[index];
    if (!pred) return;

    let summary = '';
    if (currentSport === 'football') {
        const winnerLabel = pred.prediction === '1' ? pred.home_team : pred.prediction === '2' ? pred.away_team : 'Empate';
        const prob = (pred.prediction === '1' ? pred.prob_home : pred.prediction === '2' ? pred.prob_away : pred.prob_draw) * 100;
        summary = `<strong style="color: var(--accent);">${winnerLabel}</strong> con <strong>${prob.toFixed(0)}%</strong> de probabilidad`;
    } else {
        summary = `<strong style="color: var(--accent);">${pred.winner}</strong> gana con <strong>${pred.win_probability}%</strong>`;
    }

    document.getElementById('modalTitle').textContent = `${pred.home_team} vs ${pred.away_team}`;
    document.getElementById('modalBody').innerHTML = `
        <div style="margin-bottom: 12px;">
            ${summary}
        </div>
        <p class="analysis-text">${pred.ai_analysis || 'An√°lisis de IA no disponible para este partido.'}</p>
    `;
    document.getElementById('modal').classList.add('active');
}

function closeModal() {
    document.getElementById('modal').classList.remove('active');
}

document.getElementById('modal').addEventListener('click', e => {
    if (e.target.id === 'modal') closeModal();
});

// Init
document.addEventListener('DOMContentLoaded', () => {
    loadPredictions();
    loadHistory();
    initTheme();
});
